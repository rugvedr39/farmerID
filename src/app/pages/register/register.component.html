<div
  class="register-bg d-flex align-items-center justify-content-center py-5"
  style="min-height: 100vh; background: linear-gradient(120deg, #f8fafc 80%, #e0e7ff 100%);"
>
  <div
    class="register-card bg-white shadow rounded-4 p-4 p-md-5 w-100"
    style="max-width: 420px;"
  >
    <!-- Branding -->
    <div class="text-center mb-4">
      <span class="fw-bold text-primary fs-4 d-block mb-2">All Digital Services</span>
      <i class="fa-solid fa-user-plus fa-2x text-primary mb-2"></i>
      <div class="text-muted" style="font-size: 1rem;">Create your account</div>
    </div>

    <!-- Step 1: Email Input -->
    <ng-container *ngIf="step === 'email'">
      <form (ngSubmit)="sendOTP()">
        <div class="mb-3">
          <label for="email" class="form-label">Email address</label>
          <div class="input-group rounded-pill overflow-hidden">
            <span class="input-group-text bg-light border-0">
              <i class="fa-solid fa-envelope text-primary"></i>
            </span>
            <input 
              type="email"
              class="form-control border-0"
              id="email"
              [(ngModel)]="email"
              name="email"
              required
              placeholder="Enter your email"
              [disabled]="isLoading"
            />
          </div>
        </div>
        <button
          type="submit"
          class="btn btn-primary w-100 fw-bold py-2 mb-2 rounded-pill shadow-sm"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isLoading ? 'Sending OTP...' : 'Send OTP' }}
        </button>
      </form>
      <div *ngIf="message" class="alert alert-info mt-3">{{ message }}</div>
      <div class="mt-3 text-center">
        <span>Already have an account?</span>
        <a routerLink="/login" class="text-primary text-decoration-none ms-1">Sign In</a>
      </div>
    </ng-container>

    <!-- Step 2: OTP Verification -->
    <ng-container *ngIf="step === 'otp'">
      <form (ngSubmit)="verifyOTP()">
        <div class="mb-3">
          <label for="otp" class="form-label">Verification Code</label>
          <div class="input-group rounded-pill overflow-hidden">
            <span class="input-group-text bg-light border-0">
              <i class="fa-solid fa-key text-primary"></i>
            </span>
            <input
              type="text"
              class="form-control border-0 text-center"
              id="otp"
              [(ngModel)]="otp"
              name="otp"
              required
              placeholder="000000"
              maxlength="6"
              [disabled]="isLoading"
            />
          </div>
        </div>
        <button
          type="submit"
          class="btn btn-primary w-100 fw-bold py-2 mb-2 rounded-pill shadow-sm"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isLoading ? 'Verifying...' : 'Verify OTP' }}
        </button>
      </form>
      <div *ngIf="message" class="alert alert-info mt-3">{{ message }}</div>
      <div class="d-flex justify-content-between mt-3">
        <button class="btn btn-outline-secondary" (click)="goBack()" [disabled]="isLoading">
          <i class="fa-solid fa-arrow-left me-1"></i> Back
        </button>
        <button class="btn btn-link" (click)="sendOTP()" [disabled]="isLoading">
          Resend OTP
        </button>
      </div>
    </ng-container>

    <!-- Step 3: Final Registration -->
    <ng-container *ngIf="step === 'register'">
      <form (ngSubmit)="register()">
        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <div class="input-group rounded-pill overflow-hidden">
            <span class="input-group-text bg-light border-0">
              <i class="fa-solid fa-lock text-primary"></i>
            </span>
            <input
              type="password"
              class="form-control border-0"
              id="password"
              [(ngModel)]="password"
              name="password"
              required
              placeholder="Create a password"
              [disabled]="isLoading"
            />
          </div>
        </div>
        <button
          type="submit"
          class="btn btn-primary w-100 fw-bold py-2 mb-2 rounded-pill shadow-sm"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isLoading ? 'Creating Account...' : 'Create Account' }}
        </button>
      </form>
      <div *ngIf="message" class="alert alert-info mt-3">{{ message }}</div>
      <div class="mt-3 text-center">
        <button class="btn btn-outline-secondary" (click)="goBack()" [disabled]="isLoading">
          <i class="fa-solid fa-arrow-left me-1"></i> Back
        </button>
      </div>
    </ng-container>

    <!-- Divider -->
    <div class="my-3 d-flex align-items-center">
      <hr class="flex-grow-1" />
      <span class="px-2 text-muted">or</span>
      <hr class="flex-grow-1" />
    </div>

    <!-- Google Button -->
    <button
      type="button"
      class="btn btn-outline-secondary w-100 rounded-pill d-flex align-items-center justify-content-center gap-2 mb-2"
      (click)="signInWithGoogle()"
      [disabled]="isLoading"
    >
      <i class="fa-brands fa-google"></i> Sign up with Google
    </button>

    <!-- Login link -->
    <div class="text-center mt-3">
      <span class="text-muted">Already have an account?</span>
      <a routerLink="/login" class="fw-semibold text-primary text-decoration-none ms-1">Login</a>
    </div>
  </div>
</div>